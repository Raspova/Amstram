{"version":3,"file":"_server.ts-BuvMdyoP.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/checkout/_server.ts.js"],"sourcesContent":["import { s as stripe } from \"../../../chunks/stripe.js\";\nimport { c as contenu } from \"../../../chunks/contenu.js\";\nconst POST = async ({ request }) => {\n  const data = await request.json();\n  data.price;\n  const routId = data.id;\n  const customer = await stripe.customers.create({\n    email: data.customerEmail || \"\",\n    name: data.customerName || \"\",\n    phone: data.customerPhone || \"\"\n  });\n  customer.id;\n  let vehicleTypeIndex = -1;\n  for (const lang of Object.keys(contenu)) {\n    const types = contenu[lang].vehicleTypes;\n    if (types) {\n      vehicleTypeIndex = types.indexOf(data.vType);\n      if (vehicleTypeIndex !== -1) break;\n    }\n  }\n  console.log(vehicleTypeIndex, data.vType);\n  if (vehicleTypeIndex > 3 || vehicleTypeIndex == -1)\n    vehicleTypeIndex = 1;\n  const image = [\n    \"https://fra.cloud.appwrite.io/v1/storage/buckets/6719048c00128afaa04d/files/moto/view?project=6718cd3b00059671fa73&mode=admin\",\n    \"https://fra.cloud.appwrite.io/v1/storage/buckets/6719048c00128afaa04d/files/67fe89550014ed478d56/view?project=6718cd3b00059671fa73&mode=admin\",\n    \"https://fra.cloud.appwrite.io/v1/storage/buckets/6719048c00128afaa04d/files/67fe895d00276a83e2e5/view?project=6718cd3b00059671fa73&mode=admin\",\n    \"https://fra.cloud.appwrite.io/v1/storage/buckets/6719048c00128afaa04d/files/67fe896c000260529edd/view?project=6718cd3b00059671fa73&mode=admin\"\n  ];\n  const lineItems = [{\n    price_data: {\n      currency: \"EUR\",\n      product_data: {\n        name: \"Amstram - Prise en charge de véhicule sur mesure\",\n        images: [image[vehicleTypeIndex]],\n        description: `Transport de votre ${data.vType || \"véhicule\"} de ${data.origin || \"\"} à ${data.destination || \"\"}`\n      },\n      unit_amount: data.price * 100\n    },\n    quantity: 1\n  }];\n  const session = await stripe.checkout.sessions.create({\n    line_items: lineItems,\n    //shipping_address_collection: {\n    //  allowed_countries: [\"FR\", \"BE\", \"LU\", \"CH\", \"DE\", \"ES\", \"IT\"],\n    //},\n    billing_address_collection: \"required\",\n    mode: \"payment\",\n    success_url: `https://amstram.eu/route/${routId}?success=true`,\n    cancel_url: `https://amstram.eu/route/${routId}?canceled=true`,\n    // customer: customerId,\n    phone_number_collection: {\n      enabled: true\n    },\n    locale: \"fr\",\n    //allow_promotion_codes: true,\n    custom_text: {\n      submit: {\n        message: \"Nous vous contacterons pour confirmer les détails du trajet après votre paiement.\"\n      }\n      //shipping_address: {\n      //  message: \"Veuillez fournir l'adresse où le véhicule sera pris en charge.\"\n      //}\n    },\n    payment_method_types: [\"card\"],\n    metadata: {\n      vehicleType: data.vType,\n      routeId: routId,\n      origin: data.origin,\n      destination: data.destination,\n      date: data.date\n    }\n  });\n  console.log(session.status);\n  session.id;\n  return new Response(\n    JSON.stringify({\n      url: session.url\n    }),\n    {\n      status: 200,\n      headers: {\n        \"Content-Type\": \"application/json\"\n      }\n    }\n  );\n};\nexport {\n  POST\n};\n"],"names":[],"mappings":"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"}